<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>NAS Dashboard</title>

  <!-- Make layout scale properly on mobile/tablet -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="{{ url_for('static', filename='css/all.min.css') }}">

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='icons/favicon.ico') }}">

  <!-- App Icon (iPhone / Android home screen) -->
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='icons/app-icon.png') }}">
  <link rel="manifest" href="{{ url_for('static', filename='icons/manifest.json') }}">

  <style>

{% include "_font_faces.html" %}

    /* GLOBAL FONT */
    :root {
      --bg: #0b1020;
      --bg-card: #151a2c;
      --accent: #4f8cff;
      --accent-soft: rgba(79, 140, 255, 0.15);
      --text: #f6f8ff;
      --muted: #9aa0c2;
      --radius: 16px;
      --shadow: 0 18px 40px rgba(0, 0, 0, 0.5);
      --border: 1px solid rgba(255, 255, 255, 0.04);
      --transition: 160ms ease-out;
      --sidebar-width: 320px;

      font-family: "Sequel Sans", system-ui, -apple-system, BlinkMacSystemFont,
                   "SF Pro Text", sans-serif;
      font-weight: 400; /* use roman as default */
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      color: var(--text);
      background: radial-gradient(circle at top, #18223f 0, #050814 55%, #02030a 100%);
      overflow-x: hidden;
    }

    .page-dashboard {
      min-height: 100vh;
      display: flex;
    }

    /* ───────────────── Sidebar ───────────────── */
    .sidebar {
      width: var(--sidebar-width);
      min-height: 100vh;
      background: linear-gradient(
        180deg,
        rgba(8, 12, 26, 0.95),
        rgba(9, 10, 26, 0.92)
      );
      border-right: var(--border);
      display: flex;
      flex-direction: column;
      position: fixed;
      left: 0;
      top: 0;
      z-index: 1000;
      transition: transform var(--transition);
    }

    .sidebar-header {
      padding: 24px 20px;
      border-bottom: var(--border);
    }

    .logo-title {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .dash-icon {
      width: 100px;
      height: auto;
      display: block;
      opacity: 0.95;
      margin:-30px;
    }

    .sidebar-header h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 500;
      line-height: 1.2;
    }

    .sidebar-nav {
      flex: 1;
      padding: 16px 12px;
      overflow-y: auto;
    }

    .nav-button {
      display: flex;
      align-items: center;
      gap: 12px;
      width: 100%;
      padding: 12px 16px;
      margin-bottom: 8px;
      background: transparent;
      border: none;
      border-radius: 10px;
      color: var(--text);
      font-size: 15px;
      font-weight: 500;
      text-align: left;
      cursor: pointer;
      transition: background var(--transition), color var(--transition);
      font-family: inherit;
    }

    .nav-button:hover {
      background: rgba(255, 255, 255, 0.06);
    }

    .nav-button.active {
      background: var(--accent-soft);
      color: var(--accent);
    }

    .nav-button i {
      font-size: 18px;
      width: 20px;
      text-align: center;
    }

    .sidebar-footer {
      padding: 20px;
      border-top: var(--border);
    }

    .user-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .user-info-label {
      font-size: 11px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .user-info-name {
      font-size: 14px;
      font-weight: 500;
      color: var(--text);
    }

    .sidebar-footer-links {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 12px;
    }

    .sidebar-footer-links a {
      font-size: 12px;
      padding: 8px 12px;
      border-radius: 8px;
      text-decoration: none;
      border: 1px solid rgba(255, 255, 255, 0.14);
      color: var(--text);
      text-align: center;
      transition: background var(--transition), border-color var(--transition);
    }

    .sidebar-footer-links a:hover {
      background: rgba(255, 255, 255, 0.06);
      border-color: rgba(255, 255, 255, 0.2);
    }

    /* ───────────────── Main Content ───────────────── */
    .main-content {
      flex: 1;
      min-height: 100vh;
      margin-left: var(--sidebar-width);
      background: radial-gradient(circle at top, #18223f 0, #050814 55%, #02030a 100%);
      display: flex;
      flex-direction: column;
    }

    .topbar {
      display: none; /* Hidden on desktop, shown on mobile */
      padding: 20px 16px;
      backdrop-filter: blur(12px);
      background: linear-gradient(
        90deg,
        rgba(8, 12, 26, 0.92),
        rgba(9, 10, 26, 0.7)
      );
      border-bottom: var(--border);
      align-items: center;
      gap: 12px;
    }

    .hamburger {
      background: transparent;
      border: 0;
      color: var(--text);
      font-size: 18px;
      padding: 4px 10px 2px 0;
      cursor: pointer;
      transition: background var(--transition);
    }

    .hamburger:hover {
      background: rgba(255, 255, 255, 0.06);
    }

    .page-content {
      flex: 1;
      padding: 45px;
      overflow-y: auto;
    }

    .page-heading {
      margin: 0 0 24px 0;
      font-size: 32px;
      font-weight: 500;
    }

    /* ───────────────── Link Cards (existing styles) ───────────────── */
    .links-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 18px;
    }

    .link-card {
      display: block;
      padding: 16px 16px 14px;
      background: var(--bg-card);
      border-radius: var(--radius);
      border: var(--border);
      color: var(--text);
      text-decoration: none;
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.45);
      position: relative;
      overflow: hidden;
      transition: transform var(--transition), box-shadow var(--transition),
                  border-color var(--transition), background var(--transition);
    }

    .link-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, var(--accent-soft), transparent 55%);
      opacity: 0;
      transition: opacity var(--transition);
    }

    .link-card h2 {
      margin: 15px 0 10px 0;
      font-size: 22px;
      font-weight: 500;
    }

    .link-card p {
      margin: 0;
      font-size: 14px;
      color: var(--muted);
      font-weight: 400;
      letter-spacing: 0.5px;
    }

    .link-card .link-arrow {
      position: absolute;
      right: 14px;
      bottom: 10px;
      font-size: 16px;
      color: var(--accent);
      font-weight: 700;
    }

    .link-card:hover {
      transform: translateY(-2px);
      border-color: rgba(79, 140, 255, 0.6);
      background: #181e33;
      box-shadow: 0 18px 38px rgba(0, 0, 0, 0.6);
    }

    .link-card:hover::before {
      opacity: 1;
    }

    .link-icon-circle {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      border: 1px solid rgba(255, 255, 255, 0.16);
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(5, 7, 20, 0.9);
      margin-bottom: 10px;
    }

    .link-icon-circle i {
      font-size: 18px;
      color: var(--accent);
      margin: 0 0 -2px 0;
    }
    
    
      .primary-button {
      display: inline-block;
      padding: 10px 18px;
      border-radius: 999px;
      border: 1px solid rgba(79, 140, 255, 0.9);
      background: linear-gradient(135deg, #4f8cff, #5f9bff);
      color: #ffffff;
      font-size: 14px;
      font-weight: 500;
      text-decoration: none;
      cursor: pointer;
      font-family: inherit;
      transition: transform var(--transition), box-shadow var(--transition), background var(--transition);
    }

    .primary-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.6);
      background: linear-gradient(135deg, #5f9bff, #6fa9ff);
    }

    .backup-note {
      font-size: 13px;
      color: var(--muted);
      margin-top: 8px;
    }





    /* ───────────────── Page Views ───────────────── */
    .page-view {
      display: none;
    }

    .page-view.active {
      display: block;
    }

    /* ───────────────── Logs Table Styles ───────────────── */
    .logs-card {
      background: var(--bg-card);
      border-radius: var(--radius);
      border: var(--border);
      box-shadow: var(--shadow);
      padding: 20px 24px;
    }

    .logs-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .logs-header h2 {
      margin: 0;
      font-size: 16px;
      font-weight: 500;
    }

    .logs-header span {
      font-size: 13px;
      color: var(--muted);
    }

    .logs-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    .logs-table th,
    .logs-table td {
      padding: 8px 12px;
      text-align: left;
    }

    .logs-table th {
      font-weight: 600;
      color: var(--muted);
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .logs-table tr:nth-child(even) td {
      background: rgba(255, 255, 255, 0.02);
    }

    .logs-table .col-time {
      white-space: nowrap;
    }

    .logs-empty {
      font-size: 13px;
      color: var(--muted);
      margin-top: 8px;
      text-align: center;
      padding: 20px;
    }

    /* ───────────────── System Stats Styles ───────────────── */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 18px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: var(--bg-card);
      border-radius: var(--radius);
      border: var(--border);
      box-shadow: var(--shadow);
      padding: 20px 24px;
    }

    .stat-card h2 {
      margin: 0 0 12px 0;
      font-size: 13px;
      font-weight: 500;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stat-value {
      font-size: 28px;
      font-weight: 500;
      color: var(--text);
      margin: 0;
    }

    .stat-label {
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-left: 8px;
    }

    .status-badge.cool {
      background: rgba(79, 140, 255, 0.2);
      color: var(--accent);
    }

    .status-badge.warm {
      background: rgba(255, 193, 7, 0.2);
      color: #ffc107;
    }

    .status-badge.hot {
      background: rgba(255, 79, 106, 0.2);
      color: #ff4f6a;
    }

    .status-badge.unknown {
      background: rgba(154, 160, 194, 0.2);
      color: var(--muted);
    }

    .services-card {
      background: var(--bg-card);
      border-radius: var(--radius);
      border: var(--border);
      box-shadow: var(--shadow);
      padding: 20px 24px;
    }

    .services-card h2 {
      margin: 0 0 16px 0;
      font-size: 16px;
      font-weight: 500;
      color: var(--text);
    }

    .service-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
    }

    .service-item:last-child {
      border-bottom: none;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .status-dot.status-running {
      background: #4caf50;
      box-shadow: 0 0 8px rgba(76, 175, 80, 0.5);
    }

    .status-dot.status-stopped {
      background: #f44336;
      box-shadow: 0 0 8px rgba(244, 67, 54, 0.5);
    }

    .status-dot.status-unknown {
      background: #ffc107;
      box-shadow: 0 0 8px rgba(255, 193, 7, 0.5);
    }

    .service-label {
      flex: 1;
      font-size: 15px;
      color: var(--text);
    }

    /* ───────────────── Overlay for mobile menu ───────────────── */
    .sidebar-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
      backdrop-filter: blur(4px);
    }

    .sidebar-overlay.active {
      display: block;
    }

    /* ───────────────── Responsive tweaks ───────────────── */

    /* Tablets and Mobile */
    @media (max-width: 1024px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .topbar {
        display: flex;
      }

      .page-content {
        padding: 24px 25px;
      }

      .page-heading {
        font-size: 28px;
      }

      .links-grid {
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 14px;
      }

      .logs-card {
        padding: 16px 18px;
      }

      .logs-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
        margin-bottom: 12px;
      }

      .logs-header h2 {
        font-size: 15px;
      }

      .logs-header span {
        font-size: 12px;
      }

      .logs-table {
        font-size: 12px;
      }

      .charts-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .chart-card {
        padding: 20px 24px;
      }

      .donut-wrapper {
        flex-direction: row;
        align-items: center;
        gap: 28px;
      }

      .donut {
        --donut-size: 360px;
        --donut-size-clamped: var(--donut-size);
      }

      .donut-center-label {
        font-size: 24px;
      }
    }

    /* Phones */
    @media (max-width: 768px) {
      .sidebar {
        width: 280px;
      }

      .page-content {
        padding: 20px 20px;
      }

      .page-heading {
        font-size: 24px;
        margin-bottom: 20px;
      }

      .links-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .stats-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .stat-card {
        padding: 16px 20px;
      }

      .stat-value {
        font-size: 24px;
      }

      .link-card {
        padding: 14px 14px 12px;
      }

      .link-icon-circle {
        width: 38px;
        height: 38px;
        margin-bottom: 8px;
      }

      .link-icon-circle i {
        font-size: 16px;
      }

      .link-card h2 {
        font-size: 20px;
        margin: 10px 0 8px 0;
      }

      .link-card p {
        font-size: 13px;
      }

      .link-card .link-arrow {
        right: 12px;
        bottom: 8px;
      }

      .sidebar-header {
        padding: 20px 16px;
      }

      .dash-icon {
        width: 50px;
      }

      .sidebar-header h1 {
        font-size: 18px;
      }

      .nav-button {
        padding: 10px 14px;
        font-size: 14px;
      }

      .logs-card {
        padding: 12px;
        overflow-x: auto;
      }

      .logs-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
        margin-bottom: 12px;
      }

      .logs-header h2 {
        font-size: 14px;
      }

      .logs-header span {
        font-size: 11px;
      }

      .logs-table {
        font-size: 11px;
        min-width: 600px; /* Force horizontal scroll on very small screens */
      }

      .logs-table th,
      .logs-table td {
        padding: 6px 8px;
      }

      .logs-table .col-time {
        font-size: 10px;
      }

      .charts-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }

      .chart-card {
        padding: 18px 20px;
      }

      .chart-title {
        font-size: 16px;
      }

      .donut-wrapper {
        flex-direction: column;
        align-items: stretch;
        gap: 20px;
      }

      .donut {
        --donut-size: 100%;
        --donut-size-clamped: 100%;
      }

      .donut-center-label {
        font-size: 22px;
      }

      .chart-legend {
        width: 100%;
      }

      .chart-legend-row td {
        padding: 8px 10px;
      }

      .legend-swatch {
        width: 12px;
        height: 12px;
      }

      .legend-label,
      .legend-value {
        font-size: 13px;
      }
    }


/*NAS STORAGE STATS*/

    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
      margin-top: 24px;
    }

    .chart-card {
      background: var(--bg-card);
      border-radius: var(--radius);
      border: var(--border);
      box-shadow: var(--shadow);
      padding: 24px 28px;
    }

    .chart-title {
      margin: 0 0 8px 0;
      font-size: 18px;
      font-weight: 500;
    }

    .chart-subtitle {
      margin: 0 0 20px 0;
      font-size: 13px;
      color: var(--muted);
    }

    .donut-wrapper {
      display: flex;
      align-items: center;
      gap: 40px;
    }

.donut {
  --donut-size: 400px;
  /* Clamp donut size so it never exceeds its container width */
  --donut-size-clamped: min(var(--donut-size), 100%);
  width: var(--donut-size-clamped);
  aspect-ratio: 1 / 1;
  height: auto;
  border-radius: 50%;
  position: relative;
  background: conic-gradient(var(--accent) 0deg 0deg, #2a3045 0deg 360deg);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  cursor: pointer;
}





.donut::after {
  content: "";
  width: calc(var(--donut-size-clamped) * 0.62);
  height: calc(var(--donut-size-clamped) * 0.62);
  border-radius: 50%;
  background: #0b1020;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04);
}





    .donut-center-label {
      position: absolute;
      text-align: center;
      font-size: 28px;
      font-weight: 500;
      z-index: 1;
    }

    .donut-center-sub {
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }

    .chart-legend {
      flex: 1;
      font-size: 14px;
      min-width: 0;
    }

    .chart-legend-table {
      width: 100%;
      border-collapse: collapse;
    }

    .chart-legend-row {
      display: table-row;
      transition: background var(--transition);
      cursor: default;
      position: relative;
    }

    .chart-legend-row:nth-child(odd) {
      background: rgba(255, 255, 255, 0.03);
    }

    .chart-legend-row:nth-child(even) {
      background: rgba(255, 255, 255, 0.015);
    }

    .chart-legend-row:hover {
      background: rgba(255, 255, 255, 0.06);
    }

    .chart-legend-row td {
      padding: 10px 12px;
      vertical-align: middle;
    }

    .chart-legend-row td:first-child {
      padding-left: 0;
    }

    .chart-legend-row td:last-child {
      padding-right: 0;
      text-align: right;
    }

    .legend-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .legend-swatch {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      flex-shrink: 0;
    }

    .legend-label {
      color: var(--text);
      font-weight: 500;
    }

    .legend-value {
      font-variant-numeric: tabular-nums;
      color: var(--text);
      font-weight: 500;
    }

    /* Tooltip styles */
    .chart-tooltip {
      position: absolute;
      background: rgba(21, 26, 44, 0.98);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 13px;
      pointer-events: none;
      z-index: 1000;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      gap: 8px;
      opacity: 0;
      transform: translateY(-4px);
      transition: opacity var(--transition), transform var(--transition);
    }

    .chart-tooltip.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .tooltip-swatch {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .tooltip-label {
      color: var(--text);
      font-weight: 500;
    }

    /* Colours for file-type legend + donut segments */
    .filetype-color-video     { background: #f97316; } /* orange */
    .filetype-color-music     { background: #22c55e; } /* green */
    .filetype-color-images    { background: #a855f7; } /* purple */
    .filetype-color-documents { background: #0ea5e9; } /* cyan */
    .filetype-color-archives  { background: #eab308; } /* amber */
    .filetype-color-other     { background: #64748b; } /* slate */



    /* Tablet layout for storage donuts – legend below donut */
    @media (min-width: 769px) and (max-width: 1024px) {
      .charts-grid {
        grid-template-columns: 1fr;
      }

      .donut-wrapper {
        flex-direction: column;
        align-items: center;
        gap: 20px;
      }

      .chart-legend {
        width: 100%;
      }
      
      .donut {
       margin:0 auto; 
        
      }
      
      
    }


/* ───────── Office Notify Cards ───────── */
.notify-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr)); /* 2 cards per row */
  gap: 18px;
}

.notify-card {
  background: var(--bg-card);
  border-radius: var(--radius);
  border: var(--border);
  box-shadow: var(--shadow);
  padding: 20px 24px;
  cursor: pointer;
  user-select: none;
  transition: transform var(--transition), box-shadow var(--transition),
              border-color var(--transition), background var(--transition);
  position: relative;
  overflow: hidden;
}

.notify-card::before {
  content: "";
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at top left, var(--accent-soft), transparent 55%);
  opacity: 0;
  transition: opacity var(--transition);
}

.notify-card:hover {
  transform: translateY(-2px);
  border-color: rgba(79, 140, 255, 0.6);
  background: #181e33;
  box-shadow: 0 18px 38px rgba(0, 0, 0, 0.6);
}

.notify-card:hover::before {
  opacity: 1;
}

.notify-card:active {
  transform: translateY(0);
}

.notify-icon {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: 1px solid rgba(255, 255, 255, 0.16);
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(5, 7, 20, 0.9);
  margin-bottom: 12px;
  position: relative;
  z-index: 1;
}

.notify-icon i {
  font-size: 18px;
  color: var(--accent);
}

.notify-title {
  margin: 0;
  font-size: 20px;
  font-weight: 500;
  position: relative;
  z-index: 1;
}

.notify-sub {
  margin: 6px 0 0 0;
  font-size: 13px;
  color: var(--muted);
  position: relative;
  z-index: 1;
}

.notify-hint {
  position: absolute;
  right: 16px;
  bottom: 12px;
  font-size: 16px;
  color: var(--accent);
  font-weight: 700;
  z-index: 1;
}

/* Stack on tablet + mobile */
@media (max-width: 1024px) {
  .notify-grid {
    grid-template-columns: 1fr;
  }
}







  </style>
</head>

<body class="page-dashboard">

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="logo-title">

        <h1>Basecamp<span style="color: var(--accent); font-weight: 300;">ControlCentre</span></h1>
      </div>
    </div>

    <nav class="sidebar-nav">
      <button class="nav-button active" data-page="dashboard">
        <i class="fa-solid fa-gauge-high"></i>
        <span>Dashboard</span>
      </button>
      <button class="nav-button" data-page="status">
        <i class="fa-solid fa-chart-line"></i>
        <span>Status / Data</span>
      </button>
      <button class="nav-button" data-page="storage">
        <i class="fa-solid fa-hard-drive"></i>
        <span>Storage</span>
      </button>
      <button class="nav-button" data-page="backup">
        <i class="fa-solid fa-database"></i>
        <span>Backups</span>
      </button>
      {% if session.role == 'admin' %}
      <button class="nav-button" data-page="office-notify">
        <i class="fa-solid fa-bell"></i>
        <span>Office Notify</span>
      </button>
      {% endif %}

      {% if session.role == 'admin' %}
      <button class="nav-button" data-page="logs">
        <i class="fa-solid fa-list"></i>
        <span>Logs</span>
      </button>
      {% endif %}
    </nav>






    <div class="sidebar-footer">
      <div class="user-info">
        <div class="user-info-label">Logged in as</div>
        <div class="user-info-name">{{ session.name }}</div>
      </div>
      <div class="sidebar-footer-links">
        <a href="{{ url_for('logout') }}">Log out</a>
      </div>
    </div>
  </aside>

  <!-- Overlay for mobile -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Mobile Topbar -->
    <header class="topbar">
      <button class="hamburger" id="hamburger" aria-label="Toggle menu">
        <i class="fa-solid fa-bars"></i>
      </button>
      <span style="flex: 1; font-weight: 500;font-size:18px;">Basecamp<span style="color: var(--accent); font-weight: 300;">ControlCentre</span></span>
    </header>

    <div class="page-content">
      <!-- Dashboard Page -->
      <div class="page-view active" id="page-dashboard">
        <h1 class="page-heading">Dashboard</h1>
        <section class="links-grid">
          {% for link in links %}
          <a
            class="link-card"
            href="{{ link.url }}"
            target="_blank"
            rel="noopener noreferrer"
            data-action="open_link"
            data-target="{{ link.name }}"
            onclick="sendLog(event, this)"
          >
            <div class="link-icon-circle">
              <i class="{{ link.icon }}" aria-hidden="true"></i>
            </div>

            <h2>{{ link.name }}</h2>

            {% if link.description %}
              <p>{{ link.description }}</p>
            {% endif %}

            <span class="link-arrow">↗</span>
          </a>
          {% endfor %}
        </section>
      </div>

      <!-- Status / Data Page -->
      <div class="page-view" id="page-status">
        <h1 class="page-heading">Status / Data</h1>
        
        <div class="stats-grid">
          <!-- System Uptime -->
          <div class="stat-card">
            <h2>System Uptime</h2>
            <p class="stat-value">{{ uptime }}</p>
          </div>

          <!-- Last Reboot -->
          <div class="stat-card">
            <h2>Last Reboot</h2>
            <p class="stat-value">{{ boot_time }}</p>
          </div>

          <!-- CPU Usage -->
          <div class="stat-card">
            <h2>CPU Usage</h2>
            {% if cpu_usage is not none %}
              <p class="stat-value">{{ cpu_usage }}%</p>
            {% else %}
              <p class="stat-value">Unknown</p>
            {% endif %}
          </div>

          <!-- CPU Temperature -->
          <div class="stat-card">
            <h2>CPU Temperature</h2>
            {% if cpu_temp.temperature is not none %}
              <p class="stat-value">
                {{ cpu_temp.temperature }}°C
                <span class="status-badge {{ cpu_temp.status }}">{{ cpu_temp.label }}</span>
              </p>
            {% else %}
              <p class="stat-value">Unknown</p>
            {% endif %}
          </div>

          <!-- Case Temperature -->
          <div class="stat-card">
            <h2>Case Temperature</h2>
            {% if case_temp is not none %}
              <p class="stat-value">{{ case_temp }}°C</p>
            {% else %}
              <p class="stat-value">Not detected</p>
              <p class="stat-label">DS18B20 sensor not found</p>
            {% endif %}
          </div>
        </div>

        <!-- Services Status -->
        <div class="services-card">
          <h2>System Services</h2>
          {% for service in services %}
            <div class="service-item">
              <span class="status-dot status-{{ service.status }}"></span>
              <span class="service-label">{{ service.label }}</span>
            </div>
          {% endfor %}
        </div>
      </div>
      
      
      <!-- Backups Page -->
      <div class="page-view" id="page-backup">
        <h1 class="page-heading">Backups</h1>

        {% set bs = backup_status or {} %}
        {% set status = bs.get('status') %}
        {% set last_attempt = bs.get('last_attempt') %}
        {% set last_success = bs.get('last_success') %}

        <div class="stats-grid">
          <!-- Backup Status -->
          <div class="stat-card">
            <h2>Last Backup Status</h2>
            <p class="stat-value">
              {% if status == 'success' %}
                Successful
                <span class="status-badge cool">OK</span>
              {% elif status == 'failed' %}
                Failed
                <span class="status-badge hot">Error</span>
              {% elif status == 'running' %}
                Running
                <span class="status-badge warm">In progress</span>
              {% else %}
                Unknown
                <span class="status-badge unknown">No data</span>
              {% endif %}
            </p>
            <p class="stat-label">
              This reflects the result of the most recent scheduled or manual backup.
            </p>
          </div>

          <!-- Last Attempt -->
          <div class="stat-card">
            <h2>Last Attempt</h2>
            {% if last_attempt %}
              <p class="stat-value">{{ last_attempt }}</p>
            {% else %}
              <p class="stat-value">—</p>
              <p class="stat-label">No backup has been attempted yet.</p>
            {% endif %}
          </div>

          <!-- Last Successful Backup -->
          <div class="stat-card">
            <h2>Last Successful Backup</h2>
            {% if last_success %}
              <p class="stat-value">{{ last_success }}</p>
            {% else %}
              <p class="stat-value">—</p>
              <p class="stat-label">No successful backup recorded yet.</p>
            {% endif %}
          </div>
        </div>

        <div class="services-card">
          <h2>Manual Backup</h2>
          <p class="backup-note">
            This will run <code>/usr/local/bin/nas-backup.sh</code> in the background.
            You can refresh this page to see the updated status once it completes.
          </p>

          {% if session.role == 'admin' %}
            <form action="/run-backup" method="post" onsubmit="sendLogAction('manual_backup_button', {});">
              <button type="submit" class="primary-button">Run backup now</button>
            </form>
          {% else %}
            <p class="backup-note">
              Only admin users can trigger manual backups.
            </p>
          {% endif %}
        </div>
      </div>

<!-- Office Notify Page -->
<div class="page-view" id="page-office-notify">
  <h1 class="page-heading">Office Notify</h1>

  <div class="services-card" style="margin-bottom: 18px;">
    <h2 style="display:flex;align-items:center;gap:10px;margin:0 0 12px 0;">
      <span id="officeDot" class="status-dot status-unknown"></span>
      <span id="officeStatusText">Checking device…</span>
    </h2>

    <p class="backup-note" style="margin:0;">
      Tap a card to send a message to <code>office-notify.local</code>.
    </p>

    <p class="backup-note" id="officeResult" style="margin-top:10px;"></p>
  </div>

  <div class="notify-grid">
    <div class="notify-card" role="button" tabindex="0" onclick="sendOfficeNotify('tea')" onkeydown="if(event.key==='Enter'){sendOfficeNotify('tea')}">
      <div class="notify-icon"><i class="fa-solid fa-mug-hot"></i></div>
      <h3 class="notify-title">Tea?</h3>
      <p class="notify-sub">Quick check-in.</p>
      <span class="notify-hint">↗</span>
    </div>

    <div class="notify-card" role="button" tabindex="0" onclick="sendOfficeNotify('food')" onkeydown="if(event.key==='Enter'){sendOfficeNotify('food')}">
      <div class="notify-icon"><i class="fa-solid fa-utensils"></i></div>
      <h3 class="notify-title">Food</h3>
      <p class="notify-sub">Food is ready.</p>
      <span class="notify-hint">↗</span>
    </div>

    <div class="notify-card" role="button" tabindex="0" onclick="sendOfficeNotify('free')" onkeydown="if(event.key==='Enter'){sendOfficeNotify('free')}">
      <div class="notify-icon"><i class="fa-solid fa-phone"></i></div>
      <h3 class="notify-title">Free?</h3>
      <p class="notify-sub">Are you free to talk?</p>
      <span class="notify-hint">↗</span>
    </div>

    <div class="notify-card" role="button" tabindex="0" onclick="sendOfficeNotify('other')" onkeydown="if(event.key==='Enter'){sendOfficeNotify('other')}">
      <div class="notify-icon"><i class="fa-solid fa-bell"></i></div>
      <h3 class="notify-title">Other</h3>
      <p class="notify-sub">General attention.</p>
      <span class="notify-hint">↗</span>
    </div>
  </div>
</div>







 <!-- Storage Page -->
      <div class="page-view" id="page-storage">
        <h1 class="page-heading">Storage – NASDATA</h1>

        {% if nas_storage.mounted %}
        <div class="stats-grid">
          <div class="stat-card">
            <h2>Capacity</h2>
            <p class="stat-value">
              {{ (nas_storage.total / (1024*1024*1024))|round(1) }} GB
            </p>
            <p class="stat-label">
              Used {{ (nas_storage.used / (1024*1024*1024))|round(1) }} GB ({{ nas_storage.used_percent }}%) ·
              Free {{ (nas_storage.free / (1024*1024*1024))|round(1) }} GB
            </p>
          </div>
        </div>

        <div class="charts-grid">
          <!-- Capacity Donut -->
          <div class="chart-card">
            <h2 class="chart-title">Overall Usage</h2>
            <p class="chart-subtitle">How full the NASDATA volume is.</p>
            <div class="donut-wrapper">
              <div
                class="donut"
                id="capacity-donut"
                data-used-percent="{{ nas_storage.used_percent }}"
              >
                <div class="donut-center-label">
                  {{ nas_storage.used_percent }}%
                  <div class="donut-center-sub">Used</div>
                </div>
              </div>
              <div class="chart-legend">
                <table class="chart-legend-table">
                  <tbody>
                    <tr class="chart-legend-row" data-tooltip="Used" data-color="var(--accent)">
                      <td>
                        <div class="legend-left">
                          <span class="legend-swatch" style="background: var(--accent);"></span>
                          <span class="legend-label">Used</span>
                        </div>
                      </td>
                      <td>
                        <span class="legend-value">
                          {% set used_gb = nas_storage.used / (1024*1024*1024) %}
                          {% if used_gb >= 1 %}
                            {{ used_gb|round(1) }} GB
                          {% else %}
                            {{ (used_gb * 1024)|round(0) }} MB
                          {% endif %}
                        </span>
                      </td>
                    </tr>
                    <tr class="chart-legend-row" data-tooltip="Free" data-color="#2a3045">
                      <td>
                        <div class="legend-left">
                          <span class="legend-swatch" style="background: #2a3045;"></span>
                          <span class="legend-label">Free</span>
                        </div>
                      </td>
                      <td>
                        <span class="legend-value">
                          {% set free_gb = nas_storage.free / (1024*1024*1024) %}
                          {% if free_gb >= 1 %}
                            {{ free_gb|round(1) }} GB
                          {% else %}
                            {{ (free_gb * 1024)|round(0) }} MB
                          {% endif %}
                        </span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- File Types Donut -->
          <div class="chart-card">
            <h2 class="chart-title">By File Type</h2>
            <p class="chart-subtitle">Breakdown of used space by file category.</p>
            <div class="donut-wrapper">
              <div class="donut" id="filetypes-donut">
                <div class="donut-center-label">
                  {{ nas_storage.file_types|length }}
                  <div class="donut-center-sub">Categories</div>
                </div>
              </div>
              <div class="chart-legend">
                {% if nas_storage.file_types %}
                  <table class="chart-legend-table">
                    <tbody>
                      {% for ft in nas_storage.file_types %}
                        <tr class="chart-legend-row" data-tooltip="{{ ft.label }}" data-color-class="filetype-color-{{ ft.label|lower }}">
                          <td>
                            <div class="legend-left">
                              <span class="legend-swatch filetype-color-{{ ft.label|lower }}"></span>
                              <span class="legend-label">{{ ft.label }}</span>
                            </div>
                          </td>
                          <td>
                            <span class="legend-value">
                              {% set ft_gb = ft.bytes / (1024*1024*1024) %}
                              {% if ft_gb >= 1 %}
                                {{ ft_gb|round(2) }} GB · {{ ft.percent_of_used }}%
                              {% else %}
                                {{ (ft_gb * 1024)|round(0) }} MB · {{ ft.percent_of_used }}%
                              {% endif %}
                            </span>
                          </td>
                        </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                {% else %}
                  <p class="backup-note">No files found on /mnt/nasdata yet.</p>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
        {% else %}
        <div class="services-card">
          <h2>NASDATA not available</h2>
          <p class="stat-label">
            The drive at {{ nas_storage.path }} is not mounted or could not be read.
          </p>
        </div>
        {% endif %}
      </div>



      

      <!-- Logs Page -->
      {% if session.role == 'admin' %}
      <div class="page-view" id="page-logs">
        <h1 class="page-heading">Logs</h1>
        <section class="logs-card">
          <div class="logs-header">
            <h2>Recent activity</h2>
            <span>Showing last {{ logs|length }} events</span>
          </div>

          {% if logs %}
            <table class="logs-table">
              <thead>
                <tr>
                  <th class="col-time">Time</th>
                  <th>User</th>
                  <th>Action</th>
                  <th>Details</th>
                  <th>IP</th>
                </tr>
              </thead>
              <tbody>
                {% for entry in logs %}
                  <tr>
                    <td class="col-time">{{ entry.timestamp }}</td>
                    <td>{{ entry.username }}</td>
                    <td>{{ entry.action }}</td>
                    <td>
                      {% if entry.details and entry.details.target %}
                        target: {{ entry.details.target }}
                      {% elif entry.details %}
                        {{ entry.details }}
                      {% else %}
                        –
                      {% endif %}
                    </td>
                    <td>{{ entry.ip }}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          {% else %}
            <div class="logs-empty">No log entries yet.</div>
          {% endif %}
        </section>
      </div>
      {% endif %}
    </div>
  </main>

  <script>
    // Navigation functionality
    const navButtons = document.querySelectorAll('.nav-button');
    const pageViews = document.querySelectorAll('.page-view');
    const hamburger = document.getElementById('hamburger');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    // Storage data from Flask (used by donut charts)
    const STORAGE_DATA = {{ nas_storage_json | safe }};





    // Function to navigate to a page
    function navigateToPage(pageName) {
      // Update active button
      navButtons.forEach(btn => {
        if (btn.dataset.page === pageName) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });

      // Show target page
      pageViews.forEach(view => view.classList.remove('active'));
      const targetView = document.getElementById(`page-${pageName}`);
      if (targetView) {
        targetView.classList.add('active');
      }

      // Update URL hash
      if (pageName !== 'dashboard') {
        window.location.hash = pageName;
      } else {
        window.location.hash = '';
      }

      // Log navigation action
      sendLogAction('navigate', { page: pageName });
      
      maybeRefreshOfficeNotifyOnNav(pageName);
    }
    
    
    // ───────── Office Notify ─────────
async function refreshOfficeNotifyStatus() {
  const dot = document.getElementById('officeDot');
  const text = document.getElementById('officeStatusText');
  if (!dot || !text) return;

  try {
    const r = await fetch('/office-notify/status', { cache: 'no-store' });
    const data = await r.json();

    if (data.online) {
      dot.classList.remove('status-stopped', 'status-unknown');
      dot.classList.add('status-running');
      text.textContent = 'Online';
    } else {
      dot.classList.remove('status-running', 'status-unknown');
      dot.classList.add('status-stopped');
      text.textContent = 'Offline';
    }
  } catch (e) {
    dot.classList.remove('status-running', 'status-unknown');
    dot.classList.add('status-stopped');
    text.textContent = 'Offline';
  }
}

async function sendOfficeNotify(msg) {
  const result = document.getElementById('officeResult');
  if (result) result.textContent = `Sending "${msg}"…`;


  try {
    const r = await fetch('/office-notify/send', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ msg })
    });

    const data = await r.json().catch(() => ({}));

    if (r.ok && data.ok !== false) {
      if (result) result.textContent = 'Sent ✓';
      sendLogAction('office_notify_button', { target: msg });
      refreshOfficeNotifyStatus();
      return;
    }

    if (result) result.textContent = 'Could not send (device offline or invalid message).';
  } catch (e) {
    if (result) result.textContent = 'Could not send (device offline).';
  }
}

// Refresh status when the Office Notify page is shown
function maybeRefreshOfficeNotifyOnNav(pageName) {
  if (pageName === 'office-notify') {
    refreshOfficeNotifyStatus();
  }
}





    // Check URL hash on page load
    window.addEventListener('DOMContentLoaded', () => {
      const hash = window.location.hash.slice(1); // Remove # symbol
      if (hash && hash !== 'dashboard') {
        const targetButton = document.querySelector(`.nav-button[data-page="${hash}"]`);
        if (targetButton && targetButton.closest('.sidebar-nav')) {
          navigateToPage(hash);
        }
      }
    });

    // Handle hash changes (back/forward browser buttons)
    window.addEventListener('hashchange', () => {
      const hash = window.location.hash.slice(1);
      if (hash && hash !== 'dashboard') {
        const targetButton = document.querySelector(`.nav-button[data-page="${hash}"]`);
        if (targetButton && targetButton.closest('.sidebar-nav')) {
          navigateToPage(hash);
        }
      } else {
        navigateToPage('dashboard');
      }
    });

    // Handle navigation button clicks
    navButtons.forEach(button => {
      button.addEventListener('click', () => {
        const targetPage = button.dataset.page;
        navigateToPage(targetPage);

        // Close sidebar on mobile after navigation
        if (window.innerWidth <= 1024) {
          closeSidebar();
        }
      });
    });

    // Mobile menu toggle
    function openSidebar() {
      sidebar.classList.add('open');
      sidebarOverlay.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeSidebar() {
      sidebar.classList.remove('open');
      sidebarOverlay.classList.remove('active');
      document.body.style.overflow = '';
    }

    hamburger.addEventListener('click', openSidebar);
    sidebarOverlay.addEventListener('click', closeSidebar);

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', (e) => {
      if (window.innerWidth <= 1024 && 
          sidebar.classList.contains('open') &&
          !sidebar.contains(e.target) &&
          !hamburger.contains(e.target)) {
        closeSidebar();
      }
    });

    // Close sidebar on window resize if desktop
    window.addEventListener('resize', () => {
      if (window.innerWidth > 1024) {
        closeSidebar();
      }
    });

    // Log link clicks
    function sendLog(event, el) {
      try {
        const action = el.dataset.action || "open_link";
        const target = el.dataset.target || "";
        sendLogAction(action, { target });
      } catch (e) {}
    }

    // General log action function
    function sendLogAction(action, details = {}) {
      try {
        fetch("/log-action", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ action, ...details })
        }).catch(() => {});
      } catch (e) {}
    }
    
    
        // ───────── Storage donuts ─────────
    function initStorageDonuts() {
      if (!STORAGE_DATA || !STORAGE_DATA.mounted) return;

      const accentColor = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || '#4f8cff';
      const ringInnerRatio = 0.62; // matches CSS inner-hole sizing

      // Capacity donut (used vs free)
      const capEl = document.getElementById('capacity-donut');
      if (capEl) {
        const usedPctRaw = parseFloat(capEl.dataset.usedPercent || STORAGE_DATA.used_percent || 0);
        const usedPct = Math.min(Math.max(usedPctRaw, 0), 100);
        const usedDeg = usedPct / 100 * 360;
        capEl.style.background = `conic-gradient(var(--accent) 0deg ${usedDeg}deg, #2a3045 ${usedDeg}deg 360deg)`;

        const usedDisplay = usedPct % 1 === 0 ? usedPct.toFixed(0) : usedPct.toFixed(1);
        const freePct = Math.max(0, 100 - usedPct);
        const freeDisplay = freePct % 1 === 0 ? freePct.toFixed(0) : freePct.toFixed(1);
        const capSegments = [];

        if (usedDeg > 0) {
          capSegments.push({
            label: `Used – ${usedDisplay}%`,
            color: accentColor,
            start: 0,
            end: usedDeg,
          });
        }

        if (usedDeg < 360) {
          capSegments.push({
            label: `Free – ${freeDisplay}%`,
            color: '#2a3045',
            start: usedDeg,
            end: 360,
          });
        }

        capEl.__segments = capSegments;
        capEl.__ringInnerRatio = ringInnerRatio;
      }

      // File types donut (multi-colour)
      const ftEl = document.getElementById('filetypes-donut');
      if (ftEl && Array.isArray(STORAGE_DATA.file_types) && STORAGE_DATA.file_types.length) {
        const colorMap = {
          "Video": "#f97316",
          "Music": "#22c55e",
          "Images": "#a855f7",
          "Documents": "#0ea5e9",
          "Archives": "#eab308",
          "Other": "#64748b",
        };

        let currentAngle = 0;
        const segments = [];
        const donutSegments = [];

        STORAGE_DATA.file_types.forEach(ft => {
          const pct = ft.percent_of_used || 0;
          if (pct <= 0) return;
          const deg = pct / 100 * 360;
          const start = currentAngle;
          const end = currentAngle + deg;
          currentAngle = end;
          const color = colorMap[ft.label] || "#64748b";
          segments.push(`${color} ${start}deg ${end}deg`);

          const pctDisplay = pct % 1 === 0 ? pct.toFixed(0) : pct.toFixed(1);
          donutSegments.push({
            label: `${ft.label} – ${pctDisplay}%`,
            color,
            start,
            end,
          });
        });

        if (segments.length && donutSegments.length) {
          ftEl.style.background = `conic-gradient(${segments.join(", ")})`;
          ftEl.__segments = donutSegments;
          ftEl.__ringInnerRatio = ringInnerRatio;
        }
      }
    }

    window.addEventListener('DOMContentLoaded', () => {
      // existing on-load code (hash navigation) will still run
      const hash = window.location.hash.slice(1);
      if (hash && hash !== 'dashboard') {
        const targetButton = document.querySelector(`.nav-button[data-page="${hash}"]`);
        if (targetButton && targetButton.closest('.sidebar-nav')) {
          navigateToPage(hash);
        }
      }

      // Initialise storage donuts once DOM is ready
      initStorageDonuts();

      // Initialize tooltips for donut segments
      initChartTooltips();
    });

    // ───────── Chart Tooltips ─────────
    function initChartTooltips() {
      const tooltip = getChartTooltip();
      const donuts = document.querySelectorAll('.donut');

      donuts.forEach(donut => {
        const segments = donut.__segments || [];
        if (segments.length) {
          attachDonutTooltip(donut, segments, tooltip);
        }
      });
    }

    function getChartTooltip() {
      let tooltip = document.getElementById('chart-tooltip');
      if (!tooltip) {
        tooltip = document.createElement('div');
        tooltip.className = 'chart-tooltip';
        tooltip.id = 'chart-tooltip';
        document.body.appendChild(tooltip);
      }
      return tooltip;
    }

    function attachDonutTooltip(donutEl, segments, tooltipEl) {
      if (!donutEl || !segments || !segments.length || !tooltipEl) return;
      const innerRatio = donutEl.__ringInnerRatio || 0.62;

      const handleMove = (e) => {
        const rect = donutEl.getBoundingClientRect();
        const cx = rect.left + rect.width / 2;
        const cy = rect.top + rect.height / 2;
        const dx = e.clientX - cx;
        const dy = e.clientY - cy;
        const distance = Math.sqrt(dx * dx + dy * dy);
        const outerRadius = rect.width / 2;
        const innerRadius = outerRadius * innerRatio;

        if (distance < innerRadius || distance > outerRadius) {
          tooltipEl.classList.remove('visible');
          return;
        }

        let angle = Math.atan2(dy, dx) * 180 / Math.PI + 90;
        if (angle < 0) angle += 360;

        const seg = segments.find(segment => {
          if (segment.end === 360) {
            return angle >= segment.start || angle === 0;
          }
          return angle >= segment.start && angle < segment.end;
        });

        if (!seg) {
          tooltipEl.classList.remove('visible');
          return;
        }

        tooltipEl.innerHTML = `
          <span class="tooltip-swatch" style="background: ${seg.color};"></span>
          <span class="tooltip-label">${seg.label}</span>
        `;

        tooltipEl.classList.add('visible');

        requestAnimationFrame(() => {
          const tooltipRect = tooltipEl.getBoundingClientRect();
          const margin = 10;
          let left = e.clientX - tooltipRect.width / 2;
          let top = e.clientY - tooltipRect.height - 14;
          left = Math.max(margin, Math.min(left, window.innerWidth - tooltipRect.width - margin));
          top = Math.max(margin, top);
          tooltipEl.style.left = `${left}px`;
          tooltipEl.style.top = `${top}px`;
        });
      };

      const hideTooltip = () => tooltipEl.classList.remove('visible');

      donutEl.addEventListener('mousemove', handleMove);
      donutEl.addEventListener('mouseleave', hideTooltip);
      donutEl.addEventListener('blur', hideTooltip);
    }
  </script>



</body>
</html>
